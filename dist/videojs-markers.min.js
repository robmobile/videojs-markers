/*! videojs-markers - v1.0.2-beta.1 - 2022-11-16
* Copyright (c) 2022 ; Licensed  */

!function(e,r){if("function"==typeof define&&define.amd)define(["video.js"],r);else if("undefined"!=typeof exports)r(require("video.js"));else{r(e.videojs),e.videojsMarkers={}}}(this,function(e){"use strict";var r,b=(r=e)&&r.__esModule?r:{default:r};var _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g={markerStyle:{width:"7px","border-radius":"30%","background-color":"red"},markerTip:{display:!0,text:function(e){return"Break: "+e.text},time:function(e){return e.time},html:null},breakOverlay:{display:!1,displayTime:3,text:function(e){return"Break overlay: "+e.overlayText},style:{width:"100%",height:"20%","background-color":"rgba(0,0,0,0.7)",color:"white","font-size":"17px"}},onMarkerClick:function(e){},onMarkerReached:function(e,r){},markers:[]};function M(e){var r,t={top:0,bottom:0,left:0,width:0,height:0,right:0};try{r=e.getBoundingClientRect()}catch(e){r=t}return r}var j=-1;b.default.plugin("markers",function(n){if(!b.default.mergeOptions){var o=function(e){return!!e&&"object"===(void 0===e?"undefined":_(e))&&"[object Object]"===toString.call(e)&&e.constructor===Object};b.default.mergeOptions=function i(e,r){var a={};return[e,r].forEach(function(t){t&&Object.keys(t).forEach(function(e){var r=t[e];o(r)?(o(a[e])||(a[e]={}),a[e]=i(a[e],r)):a[e]=r})}),a}}b.default.createEl||(b.default.createEl=function(e,r,t){var i=b.default.Player.prototype.createEl(e,r);return t&&Object.keys(t).forEach(function(e){i.setAttribute(e,t[e])}),i});var f=b.default.mergeOptions(g,n),s={},l=[],u=j,d=this,m=null,a=null,c=j;function r(){l.sort(function(e,r){return f.markerTip.time(e)-f.markerTip.time(r)})}function t(e){e.forEach(function(e){var t,i,c,r;e.key=(t=(new Date).getTime(),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?r:3&r|8).toString(16)})),d.el().querySelector(".vjs-progress-holder").appendChild((i=e,r=b.default.createEl("div",{},{"data-marker-key":i.key,"data-marker-time":f.markerTip.time(i)}),y(i,r),r.addEventListener("click",function(e){var r=!1;if("function"==typeof f.onMarkerClick&&(r=!1===f.onMarkerClick(i)),!r){var t=this.getAttribute("data-marker-key");d.currentTime(f.markerTip.time(s[t]))}}),f.markerTip.display&&((c=r).addEventListener("mouseover",function(){m.__activeMarkerDiv&&m.__activeMarkerDiv!=c&&h(m.__activeMarkerDiv),m.__activeMarkerDiv=c;var e,r,t,i,a,n,o,l=s[c.getAttribute("data-marker-key")],u=m.querySelector(".vjs-tip-inner");m&&(f.markerTip.html?u.innerHTML=f.markerTip.html(l):u.innerText=f.markerTip.text(l),m.style.left=k(l)+"%",e=u.firstChild||m,n=!(r=function(){var e=M(m),r=M(c);m.style.marginLeft=-parseFloat(e.width/2)+parseFloat(r.width/4)+"px",m.style.visibility="visible"}),i=i||200,t=t||10,o=0,(a=function(){n||(++o<10&&!e.offsetWidth?window.requestAnimationFrame(a):(n=!0,setTimeout(r,t)))})(),n||setTimeout(function(){n||r()},i))}),c.addEventListener("mouseout",function(){m&&!c.__hideTimeout&&(c.__hideTimeout=setTimeout(function(){h(c)},300))})),r)),s[e.key]=e,l.push(e)}),r()}function v(){return d.isLive()?d.liveTracker.seekableEnd():d.duration()}function k(e){return f.markerTip.time(e)/v()*100}function y(e,r){r.className="vjs-marker "+(e.class||""),Object.keys(f.markerStyle).forEach(function(e){r.style[e]=f.markerStyle[e]});var t=e.time/v();if(r.style.display=t<0||1<t?"none":"",r.style.left=k(e)+"%",e.duration)r.style.width=e.duration/v()*100+"%",r.style.marginLeft="0px";else{var i=M(r);r.style.marginLeft=i.width/2+"px"}}function i(i){l.forEach(function(e){var r=d.el().querySelector(".vjs-marker[data-marker-key='"+e.key+"']"),t=f.markerTip.time(e);(i||r.getAttribute("data-marker-time")!==t)&&(y(e,r),r.setAttribute("data-marker-time",t))}),r()}function p(e){a&&(c=j,a.style.visibility="hidden"),u=j;var i=[];e.forEach(function(e){var r=l[e];if(r){delete s[r.key],i.push(e);var t=d.el().querySelector(".vjs-marker[data-marker-key='"+r.key+"']");t&&t.parentNode.removeChild(t)}}),i.reverse(),i.forEach(function(e){l.splice(e,1)}),r()}function h(e){m.style.visibility="hidden",m.__activeMarkerDiv==e&&(m.__activeMarkerDiv=null),e.__hideTimeout&&clearTimeout(e.__hideTimeout),e.__hideTimeout=null}function e(){if(f.breakOverlay.display&&!(u<0)){var e=d.currentTime(),r=l[u],t=f.markerTip.time(r);t<=e&&e<=t+f.breakOverlay.displayTime?(c!==u&&(c=u,a&&(a.querySelector(".vjs-break-overlay-text").innerHTML=f.breakOverlay.text(r))),a&&(a.style.visibility="visible")):(c=j,a&&(a.style.visibility="hidden"))}}function T(){!function(){if(l.length){var e=function(e){return e<l.length-1?f.markerTip.time(l[e+1]):v()},r=d.currentTime(),t=j;if(u!==j){var i=e(u);if(r>=f.markerTip.time(l[u])&&r<i)return;if(u===l.length-1&&r===v())return}if(r<f.markerTip.time(l[0]))t=j;else for(var a=0;a<l.length;a++)if(i=e(a),r>=f.markerTip.time(l[a])&&r<i){t=a;break}t!==u&&(t!==j&&n.onMarkerReached&&n.onMarkerReached(l[t],t),u=t)}}(),e(),n.onTimeUpdateAfterMarkerUpdate&&n.onTimeUpdateAfterMarkerUpdate()}function x(){f.markerTip.display&&(m=b.default.createEl("div",{className:"vjs-tip",innerHTML:"<div class='vjs-tip-arrow'></div><div class='vjs-tip-inner'></div>"}),d.el().querySelector(".vjs-progress-holder").appendChild(m),m.addEventListener("mouseover",function(){m.__activeMarkerDiv&&m.__activeMarkerDiv.__hideTimeout&&(clearTimeout(m.__activeMarkerDiv.__hideTimeout),m.__activeMarkerDiv.__hideTimeout=null)}),m.addEventListener("mouseleave",function(){m.__activeMarkerDiv&&h(m.__activeMarkerDiv)})),d.markers.removeAll(),t(f.markers),f.breakOverlay.display&&(a=b.default.createEl("div",{className:"vjs-break-overlay",innerHTML:"<div class='vjs-break-overlay-text'></div>"}),Object.keys(f.breakOverlay.style).forEach(function(e){a&&(a.style[e]=f.breakOverlay.style[e])}),d.el().appendChild(a),c=j),T(),d.on("timeupdate",T),d.on("seekableendchange",function(){return i(!0)}),d.off("loadedmetadata")}d.on("loadedmetadata",function(){x()}),d.markers={getMarkers:function(){return l},next:function(){for(var e=d.currentTime(),r=0;r<l.length;r++){var t=f.markerTip.time(l[r]);if(e<t){d.currentTime(t);break}}},prev:function(){for(var e=d.currentTime(),r=l.length-1;0<=r;r--){var t=f.markerTip.time(l[r]);if(t+.5<e)return void d.currentTime(t)}},add:function(e){t(e)},remove:function(e){p(e)},removeAll:function(){for(var e=[],r=0;r<l.length;r++)e.push(r);p(e)},updateTime:function(e){i(e)},reset:function(e){d.markers.removeAll(),t(e)},destroy:function(){d.markers.removeAll(),a&&a.remove(),m&&m.remove(),d.off("timeupdate",e),delete d.markers}}})});