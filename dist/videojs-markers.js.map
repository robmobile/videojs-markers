{"version":3,"sources":["videojs-markers.js"],"names":["defaultSetting","markerStyle","markerTip","display","text","marker","time","html","breakOverlay","displayTime","overlayText","style","onMarkerClick","onMarkerReached","index","markers","generateUUID","d","Date","getTime","uuid","replace","c","r","Math","random","floor","toString","getElementBounding","element","elementBounding","defaultBoundingRect","top","bottom","left","width","height","right","getBoundingClientRect","e","NULL_INDEX","registerVideoJsMarkersPlugin","options","videojs","mergeOptions","isPlain","value","call","constructor","Object","source1","source2","result","sources","forEach","source","keys","key","createEl","tagName","props","attrs","el","Player","prototype","setAttribute","setting","markersMap","markersList","currentMarkerIndex","player","overlayIndex","sortMarkersList","sort","a","b","addMarkers","newMarkers","querySelector","appendChild","createMarkerDiv","push","getPlayerDuration","isLive","liveTracker","seekableEnd","duration","getPosition","setMarkderDivStyle","markerDiv","className","class","ratio","marginLeft","markerDivBounding","addEventListener","preventDefault","getAttribute","currentTime","registerMarkerTipHandler","updateMarkers","force","markerTime","removeMarkers","indexArray","visibility","deleteIndexList","parentNode","removeChild","reverse","deleteIndex","splice","waitForRendering","callback","extra","timeout","check","done","count","offsetWidth","window","requestAnimationFrame","setTimeout","hideMarkerTip","__activeMarkerDiv","__hideTimeout","clearTimeout","innerTip","innerHTML","innerText","firstChild","markerTipBounding","parseFloat","initializeMarkerTip","updateBreakOverlay","initializeOverlay","onTimeUpdate","onUpdateMarker","onTimeUpdateAfterMarkerUpdate","length","getNextMarkerTime","newMarkerIndex","nextMarkerTime","i","initialize","removeAll","on","off","getMarkers","next","prev","add","remove","updateTime","reset","destroy","plugin"],"mappings":"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","file":"videojs-markers.js","sourcesContent":["/*! videojs-markers - v1.0.2-beta.1 - 2022-11-16\r\n* Copyright (c) 2022 ; Licensed  */\r\n'use strict';\r\n\r\nimport videojs from 'video.js';\r\n\r\ntype Marker = {\r\n  time: number,\r\n  duration: number,\r\n  text?: string,\r\n  class?: string,\r\n  overlayText?: string,\r\n  // private property\r\n  key: string,\r\n};\r\n\r\n// default setting\r\nconst defaultSetting = {\r\n  markerStyle: {\r\n    'width':'7px',\r\n    'border-radius': '30%',\r\n    'background-color': 'red',\r\n  },\r\n  markerTip: {\r\n    display: true,\r\n    text: function(marker) {\r\n      return \"Break: \" + marker.text;\r\n    },\r\n    time: function(marker) {\r\n      return marker.time;\r\n    },\r\n    html: null\r\n  },\r\n  breakOverlay:{\r\n    display: false,\r\n    displayTime: 3,\r\n    text: function(marker) {\r\n      return \"Break overlay: \" + marker.overlayText;\r\n    },\r\n    style: {\r\n      'width':'100%',\r\n      'height': '20%',\r\n      'background-color': 'rgba(0,0,0,0.7)',\r\n      'color': 'white',\r\n      'font-size': '17px',\r\n    },\r\n  },\r\n  onMarkerClick: function(marker) {},\r\n  onMarkerReached: function(marker, index) {},\r\n  markers: [],\r\n};\r\n\r\n// create a non-colliding random number\r\nfunction generateUUID(): string {\r\n  var d = new Date().getTime();\r\n  var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {\r\n    var r = (d + Math.random()*16)%16 | 0;\r\n    d = Math.floor(d/16);\r\n    return (c=='x' ? r : (r&0x3|0x8)).toString(16);\r\n  });\r\n  return uuid;\r\n};\r\n\r\n/**\r\n * Returns the size of an element and its position\r\n * a default Object with 0 on each of its properties\r\n * its return in case there's an error\r\n * @param  {Element} element  el to get the size and position\r\n * @return {DOMRect|Object}   size and position of an element\r\n */\r\nfunction getElementBounding(element) {\r\n  var elementBounding;\r\n  const defaultBoundingRect = {\r\n    top: 0,\r\n    bottom: 0,\r\n    left: 0,\r\n    width: 0,\r\n    height: 0,\r\n    right: 0\r\n  };\r\n\r\n  try {\r\n    elementBounding = element.getBoundingClientRect();\r\n  } catch (e) {\r\n    elementBounding = defaultBoundingRect;\r\n  }\r\n\r\n  return elementBounding;\r\n}\r\n\r\nconst NULL_INDEX = -1;\r\n\r\nfunction registerVideoJsMarkersPlugin(options) {\r\n  // copied from video.js/src/js/utils/merge-options.js since\r\n  // videojs 4 doens't support it by defualt.\r\n  if (!videojs.mergeOptions) {\r\n    function isPlain(value) {\r\n      return !!value && typeof value === 'object' &&\r\n        toString.call(value) === '[object Object]' &&\r\n        value.constructor === Object;\r\n    }\r\n    function mergeOptions(source1: Object, source2: Object) {\r\n\r\n      const result = {};\r\n      const sources = [source1, source2];\r\n      sources.forEach(source => {\r\n        if (!source) {\r\n          return;\r\n        }\r\n        Object.keys(source).forEach(key => {\r\n          let value = source[key];\r\n          if (!isPlain(value)) {\r\n            result[key] = value;\r\n            return;\r\n          }\r\n          if (!isPlain(result[key])) {\r\n            result[key] = {};\r\n          }\r\n          result[key] = mergeOptions(result[key], value);\r\n        })\r\n      });\r\n      return result;\r\n    }\r\n    videojs.mergeOptions = mergeOptions;\r\n  }\r\n\r\n  if (!videojs.createEl) {\r\n    videojs.createEl = function(tagName: string, props: Object, attrs?: Object): void {\r\n      const el = videojs.Player.prototype.createEl(tagName, props);\r\n      if (!!attrs) {\r\n        Object.keys(attrs).forEach(key => {\r\n          el.setAttribute(key, attrs[key]);\r\n        });\r\n      }\r\n      return el;\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * register the markers plugin (dependent on jquery)\r\n   */\r\n  let setting = videojs.mergeOptions(defaultSetting, options),\r\n      markersMap: {[key:string]: Marker} = {},\r\n      markersList: Array<Marker>  = [], // list of markers sorted by time\r\n      currentMarkerIndex  = NULL_INDEX,\r\n      player       = this,\r\n      markerTip    = null,\r\n      breakOverlay = null,\r\n      overlayIndex = NULL_INDEX;\r\n\r\n  function sortMarkersList(): void {\r\n    // sort the list by time in asc order\r\n    markersList.sort((a, b) => {\r\n      return setting.markerTip.time(a) - setting.markerTip.time(b);\r\n    });\r\n  }\r\n\r\n  function addMarkers(newMarkers: Array<Marker>): void {\r\n    newMarkers.forEach((marker: Marker) => {\r\n      marker.key = generateUUID();\r\n\r\n      player.el().querySelector('.vjs-progress-holder')\r\n        .appendChild(createMarkerDiv(marker));\r\n\r\n      // store marker in an internal hash map\r\n      markersMap[marker.key] = marker;\r\n      markersList.push(marker);\r\n    })\r\n\r\n    sortMarkersList();\r\n  }\r\n\r\n  function getPlayerDuration() {\r\n    if (player.isLive()){\r\n      return player.liveTracker.seekableEnd();\r\n    }\r\n    return player.duration();\r\n  }\r\n\r\n  function getPosition(marker: Marker): number {\r\n    return (setting.markerTip.time(marker) / getPlayerDuration()) * 100;\r\n  }\r\n\r\n  function setMarkderDivStyle(marker: Marker, markerDiv: Object): void {\r\n    markerDiv.className = `vjs-marker ${marker.class || \"\"}`;\r\n\r\n    Object.keys(setting.markerStyle).forEach(key => {\r\n      markerDiv.style[key] = setting.markerStyle[key];\r\n    });\r\n\r\n    // hide out-of-bound markers\r\n    const ratio = marker.time / getPlayerDuration();\r\n    if (ratio < 0 || ratio > 1) {\r\n      markerDiv.style.display = 'none';\r\n    } else {\r\n      markerDiv.style.display = '';\r\n    }\r\n\r\n    // set position\r\n    markerDiv.style.left = getPosition(marker) + '%';\r\n    if (marker.duration) {\r\n      markerDiv.style.width = (marker.duration / getPlayerDuration()) * 100 + '%';\r\n      markerDiv.style.marginLeft = '0px';\r\n    } else {\r\n      const markerDivBounding = getElementBounding(markerDiv);\r\n      markerDiv.style.marginLeft = markerDivBounding.width / 2 + 'px';\r\n    }\r\n  }\r\n\r\n  function createMarkerDiv(marker: Marker): Object {\r\n\r\n    var markerDiv = videojs.createEl('div', {}, {\r\n      'data-marker-key': marker.key,\r\n      'data-marker-time': setting.markerTip.time(marker)\r\n    });\r\n\r\n    setMarkderDivStyle(marker, markerDiv);\r\n\r\n    // bind click event to seek to marker time\r\n    markerDiv.addEventListener('click', function(e) {\r\n      var preventDefault = false;\r\n      if (typeof setting.onMarkerClick === \"function\") {\r\n        // if return false, prevent default behavior\r\n        preventDefault = setting.onMarkerClick(marker) === false;\r\n      }\r\n\r\n      if (!preventDefault) {\r\n        var key = this.getAttribute('data-marker-key');\r\n        player.currentTime(setting.markerTip.time(markersMap[key]));\r\n      }\r\n    });\r\n\r\n    if (setting.markerTip.display) {\r\n      registerMarkerTipHandler(markerDiv);\r\n    }\r\n\r\n    return markerDiv;\r\n  }\r\n\r\n  function updateMarkers(force: boolean): void {\r\n    // update UI for markers whose time changed\r\n    markersList.forEach((marker: Marker) => {\r\n      var markerDiv = player.el().querySelector(\".vjs-marker[data-marker-key='\" + marker.key +\"']\");\r\n      var markerTime = setting.markerTip.time(marker);\r\n\r\n      if (force || markerDiv.getAttribute('data-marker-time') !== markerTime) {\r\n        setMarkderDivStyle(marker, markerDiv);\r\n        markerDiv.setAttribute('data-marker-time', markerTime);\r\n      }\r\n    });\r\n    sortMarkersList();\r\n  }\r\n\r\n  function removeMarkers(indexArray: Array<number>): void {\r\n    // reset overlay\r\n    if (!!breakOverlay){\r\n      overlayIndex = NULL_INDEX;\r\n      breakOverlay.style.visibility = \"hidden\";\r\n    }\r\n    currentMarkerIndex = NULL_INDEX;\r\n\r\n    let deleteIndexList: Array<number> = [];\r\n    indexArray.forEach((index: number) => {\r\n      let marker = markersList[index];\r\n      if (marker) {\r\n        // delete from memory\r\n        delete markersMap[marker.key];\r\n        deleteIndexList.push(index);\r\n\r\n        // delete from dom\r\n        let el = player.el().querySelector(\".vjs-marker[data-marker-key='\" + marker.key +\"']\");\r\n        el && el.parentNode.removeChild(el);\r\n      }\r\n    });\r\n\r\n    // clean up markers array\r\n    deleteIndexList.reverse();\r\n    deleteIndexList.forEach((deleteIndex: number) => {\r\n      markersList.splice(deleteIndex, 1);\r\n    });\r\n\r\n    // sort again\r\n    sortMarkersList();\r\n  }\r\n\r\n  function waitForRendering(el, callback, extra, timeout) {\r\n    var check,\r\n      done = false,\r\n      timeout = timeout || 200,\r\n      extra = extra || 10,\r\n      count = 0; // Add a count to be safe\r\n\r\n    check = function() {\r\n      // Check if timeout already expired and the callback was already executed\r\n      if (done) {\r\n        return;\r\n      }\r\n\r\n      // Check if limit number of attempts hasn't been reached and\r\n      // the element is still not fully rendered\r\n      if (++count < 10 && !el.offsetWidth) {\r\n        window.requestAnimationFrame(check);\r\n        return;\r\n      }\r\n\r\n      done = true;\r\n\r\n      // Just in case let's add an extra wait time\r\n      setTimeout(callback, extra);\r\n    }\r\n\r\n    check();\r\n\r\n    if (!done) {\r\n      setTimeout(function() {\r\n        if (!done) {\r\n          callback();\r\n        }\r\n      }, timeout);\r\n    }\r\n  }\r\n\r\n  function hideMarkerTip(markerDiv) {\r\n    markerTip.style.visibility = \"hidden\";\r\n    if (markerTip.__activeMarkerDiv == markerDiv) {\r\n      markerTip.__activeMarkerDiv = null;\r\n    }\r\n    if (markerDiv.__hideTimeout) {\r\n      clearTimeout(markerDiv.__hideTimeout);\r\n    }\r\n    markerDiv.__hideTimeout = null;\r\n  }\r\n\r\n  // attach hover event handler\r\n  function registerMarkerTipHandler(markerDiv: Object): void {\r\n    markerDiv.addEventListener('mouseover', () => {\r\n      // console.log('Div mouserover');\r\n      if (markerTip.__activeMarkerDiv && markerTip.__activeMarkerDiv != markerDiv) {\r\n        hideMarkerTip(markerTip.__activeMarkerDiv);\r\n      }\r\n      markerTip.__activeMarkerDiv = markerDiv;\r\n\r\n      var marker = markersMap[markerDiv.getAttribute('data-marker-key')];\r\n      var innerTip = markerTip.querySelector('.vjs-tip-inner');\r\n      if (!!markerTip) {\r\n        if (setting.markerTip.html) {\r\n          innerTip.innerHTML = setting.markerTip.html(marker);\r\n        } else {\r\n          innerTip.innerText = setting.markerTip.text(marker);\r\n        }\r\n\r\n        // margin-left needs to minus the padding length to align correctly with the marker\r\n        markerTip.style.left = getPosition(marker) + '%';\r\n\r\n        // Allows html to render so below measurements can be accurate\r\n        waitForRendering(innerTip.firstChild || markerTip, function () {\r\n          var markerTipBounding = getElementBounding(markerTip);\r\n          var markerDivBounding = getElementBounding(markerDiv);\r\n          markerTip.style.marginLeft =\r\n            -parseFloat(markerTipBounding.width / 2) + parseFloat(markerDivBounding.width / 4) + 'px';\r\n          markerTip.style.visibility = 'visible';\r\n        });\r\n      }\r\n    });\r\n\r\n    markerDiv.addEventListener('mouseout', () => {\r\n      // console.log('Div mouseout');\r\n      if (!!markerTip && !markerDiv.__hideTimeout) {\r\n        markerDiv.__hideTimeout = setTimeout(() => {\r\n          hideMarkerTip(markerDiv);\r\n        }, 300);\r\n      }\r\n    });\r\n  }\r\n\r\n  function initializeMarkerTip(): void {\r\n    markerTip = videojs.createEl('div', {\r\n      className: 'vjs-tip',\r\n      innerHTML: \"<div class='vjs-tip-arrow'></div><div class='vjs-tip-inner'></div>\",\r\n    });\r\n    player.el().querySelector('.vjs-progress-holder').appendChild(markerTip);\r\n\r\n    markerTip.addEventListener('mouseover', () => {\r\n      // console.log('Tip mouserover');\r\n      // Cancel marker tip timeout\r\n      if (markerTip.__activeMarkerDiv && markerTip.__activeMarkerDiv.__hideTimeout) {\r\n        clearTimeout(markerTip.__activeMarkerDiv.__hideTimeout);\r\n        markerTip.__activeMarkerDiv.__hideTimeout = null;\r\n      }\r\n    });\r\n\r\n    markerTip.addEventListener('mouseleave', () => {\r\n      // console.log('Tip mouseleave');\r\n      if (markerTip.__activeMarkerDiv) {\r\n        hideMarkerTip(markerTip.__activeMarkerDiv);\r\n      }\r\n    });\r\n  }\r\n\r\n  // show or hide break overlays\r\n  function updateBreakOverlay(): void {\r\n    if (!setting.breakOverlay.display || currentMarkerIndex < 0) {\r\n      return;\r\n    }\r\n\r\n    var currentTime = player.currentTime();\r\n    var marker = markersList[currentMarkerIndex];\r\n    var markerTime = setting.markerTip.time(marker);\r\n\r\n    if (\r\n      currentTime >= markerTime &&\r\n      currentTime <= (markerTime + setting.breakOverlay.displayTime)\r\n    ) {\r\n      if (overlayIndex !== currentMarkerIndex) {\r\n        overlayIndex = currentMarkerIndex;\r\n        if (breakOverlay) {\r\n          breakOverlay.querySelector('.vjs-break-overlay-text').innerHTML = setting.breakOverlay.text(marker);\r\n        }\r\n      }\r\n\r\n      if (breakOverlay) {\r\n        breakOverlay.style.visibility = \"visible\";\r\n      }\r\n    } else {\r\n      overlayIndex = NULL_INDEX;\r\n      if (breakOverlay) {\r\n        breakOverlay.style.visibility = \"hidden\";\r\n      }\r\n    }\r\n  }\r\n\r\n  // problem when the next marker is within the overlay display time from the previous marker\r\n  function initializeOverlay(): void {\r\n    breakOverlay = videojs.createEl('div', {\r\n      className: 'vjs-break-overlay',\r\n      innerHTML: \"<div class='vjs-break-overlay-text'></div>\"\r\n    });\r\n    Object.keys(setting.breakOverlay.style).forEach(key => {\r\n      if (breakOverlay) {\r\n        breakOverlay.style[key] = setting.breakOverlay.style[key];\r\n      }\r\n    });\r\n    player.el().appendChild(breakOverlay);\r\n    overlayIndex = NULL_INDEX;\r\n  }\r\n\r\n  function onTimeUpdate(): void {\r\n    onUpdateMarker();\r\n    updateBreakOverlay();\r\n    options.onTimeUpdateAfterMarkerUpdate && options.onTimeUpdateAfterMarkerUpdate();\r\n  }\r\n\r\n  function onUpdateMarker() {\r\n    /*\r\n      check marker reached in between markers\r\n      the logic here is that it triggers a new marker reached event only if the player\r\n      enters a new marker range (e.g. from marker 1 to marker 2). Thus, if player is on marker 1 and user clicked on marker 1 again, no new reached event is triggered)\r\n    */\r\n    if (!markersList.length) {\r\n      return;\r\n    }\r\n\r\n    var getNextMarkerTime = (index: number) => {\r\n      if (index < markersList.length - 1) {\r\n        return setting.markerTip.time(markersList[index + 1]);\r\n      }\r\n      // next marker time of last marker would be end of video time\r\n      return getPlayerDuration();\r\n    }\r\n    var currentTime = player.currentTime();\r\n    var newMarkerIndex = NULL_INDEX;\r\n\r\n    if (currentMarkerIndex !== NULL_INDEX) {\r\n      // check if staying at same marker\r\n      var nextMarkerTime = getNextMarkerTime(currentMarkerIndex);\r\n      if(\r\n        currentTime >= setting.markerTip.time(markersList[currentMarkerIndex]) &&\r\n        currentTime < nextMarkerTime\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      // check for ending (at the end current time equals player duration)\r\n      if (\r\n        currentMarkerIndex === markersList.length - 1 &&\r\n        currentTime === getPlayerDuration()\r\n      ) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    // check first marker, no marker is selected\r\n    if (currentTime < setting.markerTip.time(markersList[0])) {\r\n      newMarkerIndex = NULL_INDEX;\r\n    } else {\r\n      // look for new index\r\n      for (var i = 0; i < markersList.length; i++) {\r\n        nextMarkerTime = getNextMarkerTime(i);\r\n        if (\r\n          currentTime >= setting.markerTip.time(markersList[i]) &&\r\n          currentTime < nextMarkerTime\r\n        ) {\r\n          newMarkerIndex = i;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    // set new marker index\r\n    if (newMarkerIndex !== currentMarkerIndex) {\r\n      // trigger event if index is not null\r\n      if (newMarkerIndex !== NULL_INDEX && options.onMarkerReached) {\r\n        options.onMarkerReached(markersList[newMarkerIndex], newMarkerIndex);\r\n      }\r\n      currentMarkerIndex = newMarkerIndex;\r\n    }\r\n  }\r\n\r\n  // setup the whole thing\r\n  function initialize(): void {\r\n    if (setting.markerTip.display) {\r\n      initializeMarkerTip();\r\n    }\r\n\r\n    // remove existing markers if already initialized\r\n    player.markers.removeAll();\r\n    addMarkers(setting.markers);\r\n\r\n    if (setting.breakOverlay.display) {\r\n      initializeOverlay();\r\n    }\r\n    onTimeUpdate();\r\n    player.on(\"timeupdate\", onTimeUpdate);\r\n    player.on(\"seekableendchange\", () => updateMarkers(true))\r\n    player.off(\"loadedmetadata\");\r\n  }\r\n\r\n  // setup the plugin after we loaded video's meta data\r\n  player.on(\"loadedmetadata\", function() {\r\n    initialize();\r\n  });\r\n\r\n  // exposed plugin API\r\n  player.markers = {\r\n    getMarkers: function(): Array<Marker> {\r\n      return markersList;\r\n    },\r\n    next : function(): void {\r\n      // go to the next marker from current timestamp\r\n      const currentTime = player.currentTime();\r\n      for (var i = 0; i < markersList.length; i++) {\r\n        var markerTime = setting.markerTip.time(markersList[i]);\r\n        if (markerTime > currentTime) {\r\n          player.currentTime(markerTime);\r\n          break;\r\n        }\r\n      }\r\n    },\r\n    prev : function(): void {\r\n      // go to previous marker\r\n      const currentTime = player.currentTime();\r\n      for (var i = markersList.length - 1; i >= 0 ; i--) {\r\n        var markerTime = setting.markerTip.time(markersList[i]);\r\n        // add a threshold\r\n        if (markerTime + 0.5 < currentTime) {\r\n          player.currentTime(markerTime);\r\n          return;\r\n        }\r\n      }\r\n    },\r\n    add : function(newMarkers: Array<Marker>): void {\r\n      // add new markers given an array of index\r\n      addMarkers(newMarkers);\r\n    },\r\n    remove: function(indexArray: Array<number>): void {\r\n      // remove markers given an array of index\r\n      removeMarkers(indexArray);\r\n    },\r\n    removeAll: function(): void {\r\n      var indexArray = [];\r\n      for (var i = 0; i < markersList.length; i++) {\r\n        indexArray.push(i);\r\n      }\r\n      removeMarkers(indexArray);\r\n    },\r\n    // force - force all markers to be updated, regardless of if they have changed or not.\r\n    updateTime: function(force: boolean): void {\r\n      // notify the plugin to update the UI for changes in marker times\r\n      updateMarkers(force);\r\n    },\r\n    reset: function(newMarkers: Array<Marker>): void {\r\n      // remove all the existing markers and add new ones\r\n      player.markers.removeAll();\r\n      addMarkers(newMarkers);\r\n    },\r\n    destroy: function(): void {\r\n      // unregister the plugins and clean up even handlers\r\n      player.markers.removeAll();\r\n      breakOverlay && breakOverlay.remove();\r\n      markerTip && markerTip.remove();\r\n      player.off(\"timeupdate\", updateBreakOverlay);\r\n      delete player.markers;\r\n    },\r\n  };\r\n}\r\n\r\nvideojs.plugin('markers', registerVideoJsMarkersPlugin);\r\n"]}